"use strict";(self.webpackChunkalemonjs_docs=self.webpackChunkalemonjs_docs||[]).push([[702],{7605:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>i,contentTitle:()=>r,default:()=>p,frontMatter:()=>o,metadata:()=>c,toc:()=>l});var a=t(4848),s=t(8453);const o={sidebar_position:3},r="\u81ea\u5b9a\u4e49\u5e73\u53f0",c={id:"alemonjsDocs/expert/platforms",title:"\u81ea\u5b9a\u4e49\u5e73\u53f0",description:"\u5bf9\u63a5\u4efb\u610f\u5f00\u653e\u5e73\u53f0\u548c\u6846\u67b6",source:"@site/docs/alemonjsDocs/expert/3-platforms.md",sourceDirName:"alemonjsDocs/expert",slug:"/alemonjsDocs/expert/platforms",permalink:"/docs/alemonjsDocs/expert/platforms",draft:!1,unlisted:!1,editUrl:"https://github.com/lemonade-lab/alemonjs-docs/docs/alemonjsDocs/expert/3-platforms.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"\u5b9e\u4f8b\u5bf9\u8c61",permalink:"/docs/alemonjsDocs/expert/class"},next:{title:"\u5f00\u653e",permalink:"/docs/category/\u5f00\u653e"}},i={},l=[{value:"\u5bfc\u51fa",id:"\u5bfc\u51fa",level:2}];function d(n){const e={admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,s.R)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.header,{children:(0,a.jsx)(e.h1,{id:"\u81ea\u5b9a\u4e49\u5e73\u53f0",children:"\u81ea\u5b9a\u4e49\u5e73\u53f0"})}),"\n",(0,a.jsx)(e.admonition,{type:"tip",children:(0,a.jsx)(e.p,{children:"\u5bf9\u63a5\u4efb\u610f\u5f00\u653e\u5e73\u53f0\u548c\u6846\u67b6"})}),"\n",(0,a.jsx)(e.h2,{id:"\u5bfc\u51fa",children:"\u5bfc\u51fa"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-js",metastring:'title="src/index.ts"',children:"import {\n    createResult,\n    ResultCode,\n    getConfigValue,\n    cbpPlatform,\n    PublicEventMessageCreate\n} from 'alemonjs'\n\n// \u5e73\u53f0\u540d\u79f0\nexport const platform = 'bot-name'\n// \u63a5\u53e3\nexport class API { }\n// \u914d\u7f6e\u53c2\u6570\nexport type Options = {\n    token: string\n}\n\nconst getBotConfig = (): Options => {\n    const value = getConfigValue() || {}\n    return value[platform] || {}\n}\n\nclass Client extends API {\n    #token: string\n\n    constructor(options: Options) {\n        super()\n        this.#token = options.token\n    }\n\n    onmessage = (data: any) => {\n        //\n    }\n}\n\nexport default () => {\n    // \u5f97\u5230\u81ea\u5b9a\u4e49\u914d\u7f6e\n    const config = getBotConfig()\n\n    /**\n     * \u8fde\u63a5 dbp \u670d\u52a1\u5668\u3002\u63a8\u9001\u6807\u51c6\u4fe1\u606f\u3002\n     */\n    const port = process.env?.port || 17117\n    const url = `ws://127.0.0.1:${port}`\n    const cbp = cbpPlatform(url)\n\n\n    const client = new Client({\n        token: config.token\n    })\n\n    client.onmessage = data => {\n\n        const e: PublicEventMessageCreate = {\n            name: 'message.create',\n            value: data\n            // ...\n        }\n\n        // event\n        cbp.send(e)\n    }\n\n    const sendMessage = async (event, param) => {\n        // \u5904\u7406  client.send\n        return []\n    }\n\n    cbp.onactions(async (data, consume) => {\n        if (data.action === 'message.send') {\n            const event = data.payload.event\n            const paramFormat = data.payload.params.format\n            const res = await sendMessage(event, paramFormat)\n            consume(res)\n        } else if (data.action === 'message.send.channel') {\n            const channel_id = data.payload.ChannelId\n            const val = data.payload.params.format\n        } else if (data.action === 'message.send.user') {\n            const user_id = data.payload.UserId\n            const val = data.payload.params.format\n        } else if (data.action === 'mention.get') {\n            const event = data.payload.event\n        }\n    })\n\n    // \u5904\u7406 api \u8c03\u7528\n    cbp.onapis(async (data, consume) => {\n        const key = data.payload?.key\n        if (client[key]) {\n            // \u5982\u679c client \u4e0a\u6709\u5bf9\u5e94\u7684 key\uff0c\u76f4\u63a5\u8c03\u7528\u3002\n            const params = data.payload.params\n            const res = await client[key](...params)\n            consume([\n                createResult(ResultCode.Ok, '\u8bf7\u6c42\u5b8c\u6210', res)\n            ])\n        }\n    })\n}\n"})})]})}function p(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(d,{...n})}):d(n)}},8453:(n,e,t)=>{t.d(e,{R:()=>r,x:()=>c});var a=t(6540);const s={},o=a.createContext(s);function r(n){const e=a.useContext(o);return a.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:r(n.components),a.createElement(o.Provider,{value:e},n.children)}}}]);